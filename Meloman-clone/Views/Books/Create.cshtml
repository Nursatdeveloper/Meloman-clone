@model Meloman_clone.Models.Book

@{
    ViewData["Title"] = "Create";
}

<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/@@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>

<div class="form-container">
    <div class="row row-cols-auto">
        <div class="col">
            <input type="text" placeholder="Id" id="id-input" />
        </div>
        <div class="col">
            <button id="find-book" class="find-btn">Find</button>
        </div>
        <div class="col">
            <label class="form-title">Add Or Edit Book</label>
        </div>
    </div>
    <div class="row row-cols-auto">
        <div class="col">
            <label>
                Book name
            </label>
            <input id="name" type="text" placeholder="Book name" />
        </div>
        <div class="col">
            <label>
                Book Author
            </label>
            <input id="author" type="text" placeholder="Book author" />
        </div>
        <div class="col">
            <label>
                Category
            </label>
            <input id="category" type="text" placeholder="Category" />
        </div>
    </div>
    <div class="row row-cols-auto">
        <div class="col">
            <label>
                Old Price
            </label>
            <input id="old-price" type="text" placeholder="Old price" />
        </div>
        <div class="col">
            <label>
                Price
            </label>
            <input id="price" type="text" placeholder="Price" />
        </div>
        <div class="col">
            <label>
                Discount
            </label>
            <input id="discount" type="text" placeholder="Discount" />
        </div>
    </div>
    <div class="row">
        <label class="specific-chars">
            Specific characteristics
        </label>
    </div>
    <div class="row row-cols-auto">
        <div class="col">
            <label>
                Genre
            </label>
            <input id="genre" type="text" placeholder="Genre" />
        </div>
        <div class="col">
            <label>
                ISBN
            </label>
            <input id="isbn" type="text" placeholder="ISBN" />
        </div>
    </div>
    <div class="row row-cols-auto">
        <div class="col">
            <label>
                Publisher
            </label>
            <input id="publisher" type="text" placeholder="Publisher" />
        </div>
        <div class="col">
            <label>
                Published Year
            </label>
            <input id="publish-year" type="text" placeholder="Published year" />
        </div>
        <div class="col">
            <label>
                Suggested Age
            </label>
            <input id="suggested-age" type="text" placeholder="Suggested age" />
        </div>
    </div>
    <div class="row row-cols-auto">
        <div class="col">
            <label>
                Cover
            </label>
            <input id="cover" type="text" placeholder="Cover" />
        </div>
        <div class="col">
            <label>
                Weight (g)
            </label>
            <input id="weight" type="text" placeholder="Weight" />
        </div>
        <div class="col">
            <label>
                Size (length x width x height)
            </label>
            <input id="size" type="text" placeholder="Size" />
        </div>
    </div>
    <div class="row row-cols-auto">
        <div class="col">
            <label>
                Language
            </label>
            <input id="language" type="text" placeholder="Language" />
        </div>
        <div class="col">
            <label>
                Page number
            </label>
            <input id="page-num" type="text" placeholder="Page number" />
        </div>
        <div class="col">
            <label>
                Amount
            </label>
            <input id="amount" type="text" placeholder="Amount" />
        </div>
    </div>
    <div class="row row-cols-auto">
        <div class="col">
            <label>
                Front cover photo
            </label>
            <input id="front-photo" type="file" value="Upload File" />
        </div>
        <div class="col">
            <label>
                Back cover photo
            </label>
            <input id="back-photo" type="file" value="Upload File" />
        </div>
    </div>
    <div class="row" id="btn-wrapper">
        <button id="submit-form">Submit</button>
    </div>
    <input id="action-type" type="hidden" value="" />
</div>

<div class="message position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <div class="rounded me-2 message-header"></div>
            <strong class="me-auto">Message</strong>
            <small></small>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">

        </div>
    </div>
</div>

<!-- Category and genre select modal-->
<div class="category-select-modal-wrapper">
    <div class="category-select-modal-header">
        Выберите категорию книги
        <button type="button" class="btn-close" id="modal-close-btn"></button>
    </div>
    <div class="category-select-modal-body">
        <div class="select-option">
            <span>Категория</span>
            <select id="category-select-id">
                <option value="--">--</option>
                <option value="Художественная литература">Художественная литература</option>
                <option value="Психологическая литература">Психологическая литература</option>
                <option value="Детская литература">Детская литература</option>
                <option value="Научно-популярная литература">Научно-популярная литература</option>
                <option value="Книги по бизнесу">Книги по бизнесу</option>
            </select>
        </div>
        <div class="select-option">
            <span>Жанр</span>
            <select id="genre-select-id">
            </select>
        </div>
    </div>
</div>

<!-- Book cover select modal-->
<div class="cover-select-modal">
    <h3>
        Выберите переплет книги
        <svg id="cover-select-close" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M13.854 2.146a.5.5 0 0 1 0 .708l-11 11a.5.5 0 0 1-.708-.708l11-11a.5.5 0 0 1 .708 0Z" />
            <path fill-rule="evenodd" d="M2.146 2.146a.5.5 0 0 0 0 .708l11 11a.5.5 0 0 0 .708-.708l-11-11a.5.5 0 0 0-.708 0Z" />
        </svg>
    </h3>
    <select id="cover-select-id">
        <option value="--">Выберите переплет книги</option>
        <option value="Твердый переплет">Твердый переплет</option>
        <option value="Мягкая обложка">Мягкая обложка</option>
    </select>
    <br />
    <button id="cover-select-btn">Сохранить</button>
</div>

<script>
    $(document).ready(function () {
        $(".category-select-modal-wrapper").hide();
        $(".cover-select-modal").hide();
    });
    function ResetFields() {
        $("#amount, #id-input, #name, #author, #category, #old-price, #price, #discount, #genre, #isbn, #publisher, #publish-year, #suggested-age, #cover, #weight, #size, #language, #page-num").val("");
    }
    function ShowUpdateMessage() {
        var toastLiveExample = document.getElementById('liveToast')
        $(".toast-body").text("Book is updated!");
        var toast = new bootstrap.Toast(toastLiveExample)
        toast.show()
    }
    function ShowSaveMessage() {
        var toastLiveExample = document.getElementById('liveToast')
        $(".toast-body").text("Book is saved!");
        var toast = new bootstrap.Toast(toastLiveExample)
        toast.show()
    }
    $("#front-photo").change(function (event) {
        var files = event.target.files;
    });
    $("#back-photo").change(function (event) {
        var files = event.target.files;
    });
    $("#submit-form").click(function () {
        var frontPhoto = $("#front-photo").prop("files");
        var backPhoto = $("#back-photo").prop("files");
        var formData = new FormData();
        for (var i = 0; i < frontPhoto.length; i++) {
            formData.append("FrontPhoto", frontPhoto[i]);
        }
        for (var j = 0; j < backPhoto.length; j++) {
            formData.append("BackPhoto", backPhoto[j]);
        }

        if ($("#action-type").val() == 'update') {
            var bookObj = {
                BookId: $("#id-input").val(),
                Name: $("#name").val(),
                Author: $("#author").val(),
                Category: $("#category").val(),
                OldPrice: $("#old-price").val(),
                Price: $("#price").val(),
                Discount: $("#discount").val(),
                Genre: $("#genre").val(),
                Isbn: $("#isbn").val(),
                Publisher: $("#publisher").val(),
                PublishedYear: $("#publish-year").val(),
                SuggestedAge: $("#suggested-age").val(),
                Cover: $("#cover").val(),
                Weight: $("#weight").val(),
                Size: $("#size").val(),
                Language: $("#language").val(),
                PageAmount: $("#page-num").val(),
                Amount: $("#amount").val()
            };
            formData.append("Book", JSON.stringify(bookObj));
            $.ajax({
                type: "POST",
                url: "/Books/UpdateBook",
                data: formData,
                processData: false,
                contentType: false,
                success: function (data) {
                    ResetFields();
                    $("#action-type").val("");
                    ShowUpdateMessage();
                },
                error: function (data) {
                    console.log("Error:", data);
                }
            });
        }
        else {
            var bookObj = {
                Name: $("#name").val(),
                Author: $("#author").val(),
                Category: $("#category").val(),
                OldPrice: $("#old-price").val(),
                Price: $("#price").val(),
                Discount: $("#discount").val(),
                Genre: $("#genre").val(),
                Isbn: $("#isbn").val(),
                Publisher: $("#publisher").val(),
                PublishedYear: $("#publish-year").val(),
                SuggestedAge: $("#suggested-age").val(),
                Cover: $("#cover").val(),
                Weight: $("#weight").val(),
                Size: $("#size").val(),
                Language: $("#language").val(),
                PageAmount: $("#page-num").val(),
                Amount: $("#amount").val()
            };
            formData.append("Book", JSON.stringify(bookObj));
            $.ajax({
                type: "POST",
                url: "/Books/SaveBook",
                data: formData,
                processData: false,
                contentType: false,
                success: function (data) {
                    ResetFields();
                    ShowSaveMessage();
                },
                error: function (data) {
                    console.log("Error:", data);
                }
            })
        };

    });
    $("#find-book").click(function () {
        var id = $("#id-input").val();
        $.ajax({
            type: "POST",
            url: "/Books/FindBook",
            data: { 'id': id },
            cache: false,
            success: function (data) {
                if (data == "Does not exist!") {
                    alert(data);
                }
                $("#name").val(data.Name),
                    $("#author").val(data.Author),
                    $("#category").val(data.Category),
                    $("#old-price").val(data.OldPrice),
                    $("#price").val(data.Price),
                    $("#discount").val(data.Discount),
                    $("#genre").val(data.Genre),
                    $("#isbn").val(data.Isbn),
                    $("#publisher").val(data.Publisher),
                    $("#publish-year").val(data.PublishedYear),
                    $("#suggested-age").val(data.SuggestedAge),
                    $("#cover").val(data.Cover),
                    $("#weight").val(data.Weight),
                    $("#size").val(data.Size),
                    $("#language").val(data.Language),
                    $("#page-num").val(data.PageAmount),
                    $("#amount").val(data.Amount)
                $("#action-type").val("update")
                console.log(data.PhotoFront);
            },
            error: function (err) {
                console.log(err);
            }
        });
    });



    // category and genre modal logic
    $("#category").focus(function () {
        $(".category-select-modal-wrapper").show();
        console.log('clicked');
    })
    $("#category-select-id").change(function () {
        var category = $(this).find('option:selected').text();
        $("#category").val(category);
        $("#genre-select-id").empty();
        if (category == 'Художественная литература') {
            AddFictionGenreOptions();
        }
        else if (category == 'Психологическая литература') {
            AddPsychologyGenreOptions();
        }
        else if (category == 'Детская литература') {
            AddChildGenreOptions();
        } else if (category == 'Научно-популярная литература') {
            AddNonFictionGenreOptions();
        } else if (category == 'Книги по бизнесу') {
            AddBusinessGenreOptions();
        }
    })
    $("#genre-select-id").change(function () {
        var genre = $(this).find('option:selected').text();
        $("#genre").val(genre);
        $(".category-select-modal-wrapper").hide();
    });
    $("#modal-close-btn").click(function () {
        $(".category-select-modal-wrapper").hide();
    })
    function AddFictionGenreOptions() {
        $("#genre-select-id").append('<option>--</option>')
            .append('<option>Всемирная классика</option>')
            .append('<option>Русская классика</option>')
            .append('<option>Современная проза</option>')
            .append('<option>Поэзия</option>')
            .append('<option>Афоризмы</option>')
    }
    function AddPsychologyGenreOptions() {
        $("#genre-select-id").append('<option>--</option>')
            .append('<option>Практическая психология</option>')
            .append('<option>Популярная психология</option>')
            .append('<option>Психология детей и подростков</option>')
            .append('<option>Психология отношений</option>')
            .append('<option>Психология личности</option>')
    }
    function AddChildGenreOptions() {
        $("#genre-select-id").append('<option>--</option>')
            .append('<option>Книги для подростков</option>')
            .append('<option>Внеклассное чтение</option>')
            .append('<option>Сказки</option>')
            .append('<option>Развивающая литература</option>')
            .append('<option>Познавательная литература</option>')
    }
    function AddNonFictionGenreOptions() {
        $("#genre-select-id").append('<option>--</option>')
            .append('<option>Естественные науки</option>')
            .append('<option>Гуманитарные науки</option>')
            .append('<option>Наука. Технологий</option>')
    }
    function AddBusinessGenreOptions() {
        $("#genre-select-id").append('<option>--</option>')
            .append('<option>Маркетинг. Реклама. PR</option>')
            .append('<option>Интернет. Сайты. Соцсети</option>')
            .append('<option>Личная эффективность</option>')
            .append('<option>IT в бизнесе</option>')
            .append('<option>Банки, финансы, право</option>')
            .append('<option>Стартапы. Предпринимательство</option>')
            .append('<option>Лидерство. Бизнес-психология</option>')
            .append('<option>Личные финансы</option>')
    }

    //cover modal logic
    $("#cover").focus(function () {
        $(".cover-select-modal").show();
    })
    $("#cover-select-id").change(function () {
        var cover = $(this).find('option:selected').text();
        $("#cover").val(cover);
    })
    $("#cover-select-close").click(function () {
        $(".cover-select-modal").hide();
        $("#cover").val('');
    })
    $("#cover-select-btn").click(function () {
        $(".cover-select-modal").hide();
    })

</script>

<style>
    #cover-select-close {
        margin-left: 10px;
    }

    #cover-select-btn {
        margin-top: 15px;
        display: block;
        width: 100px;
        margin-left: auto;
        margin-right: auto;
    }

    .cover-select-modal {
        border: 2px solid #4d4d4d;
        width: fit-content;
        padding: 0px 10px 10px 10px;
        position:absolute;
        top:30%;
        left:40%;
        background-color:white;
    }
    #modal-close-btn {
        margin-left: 30px;
        margin-top: 5px;
    }

    #genre-select-id {
        width: 200px;
    }

    .container {
        margin-top: 20px;
    }

    .category-select-modal-wrapper {
        height: 270px;
        margin-left: auto;
        margin-right: auto;
        width: fit-content;
        font-family: 'Proxima','Helvetica Neue',Helvetica,Arial,sans-serif;
        color: #4d4d4d;
        box-shadow: -1px -2px 22px 1px rgba(34, 60, 80, 0.15);
        z-index: 2;
        border: 2px solid #0100d3;
        position: absolute;
        top: 100px;
        left: 35%;
        background-color: white;
    }

    .category-select-modal-header {
        font-size: 20px;
        font-weight: 600;
        margin-left: 10px;
        margin-right: 10px;
        margin-top: 5px;
    }

    .category-select-modal-body {
        margin-left: 10px;
        margin-right: 10px;
        margin-top: 20px;
        height: 200px;
    }

    .select-option {
        height: 70px;
        margin-top: 20px;
    }

    .message {
        position: absolute;
        top: 100px;
    }

    .message-header {
        width: 15px;
        height: 15px;
        background-color: green;
        border-radius: 3px;
    }

    input {
        width: 250px;
    }

    .row {
        margin-bottom: 20px;
        margin-left: 20px;
    }

    .form-container {
        margin-left: 12.5%;
        margin-top: 20px;
        margin-right: 12.5%;
        box-shadow: -1px -2px 22px 1px rgba(34, 60, 80, 0.15);
        padding-bottom: 20px;
        padding-top: 20px;
        z-index: 1;
        margin-bottom: 50px;
    }

    .specific-chars {
        text-align: center;
        font-size: 24px;
        font-weight: 600;
    }

    .form-title {
        text-align: center;
        font-size: 30px;
        font-weight: 600;
    }

    #id-input {
        margin-top: 10px;
    }

    #find-book {
        margin-top: 10px;
        height: 30px;
    }

        #find-book:hover {
            background-color: #0080ff;
        }

    .find-btn {
        border-radius: 8px;
        border: 0px;
        background-color: #0099ff;
        color: white;
        margin-right: 60px;
    }

    #price {
        width: 140px;
    }

    #old-price {
        width: 140px;
    }

    #discount {
        width: 100px;
    }

    #publish-year {
        width: 130px;
    }

    #suggested-year {
        width: 130px;
    }

    #weight {
        width: 100px;
    }

    #page-num {
        width: 120px;
    }

    #submit-form {
        width: fit-content;
        border-radius: 5px;
        background-color: #0100d3;
        color: white;
        border: 0;
    }

        #submit-form:hover {
            background-color: #0000b3;
        }

    #btn-wrapper {
        margin-left: 44%;
    }

    #amount {
        width: 100px;
    }
</style>


